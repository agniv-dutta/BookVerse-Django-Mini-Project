{% extends 'book_outlet/base.html' %}
{% load static %}

{% block title %}Order Details - BookStore{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>Order Details</h1>
    
    <div class="card">
        <div class="card-header">
            <div class="row">
                <div class="col-md-6">
                    <h5>Order #{{ order.order_number }}</h5>
                </div>
                <div class="col-md-6 text-end">
                    <span class="badge bg-{% if order.status == 'delivered' %}success{% elif order.status == 'cancelled' %}danger{% else %}warning{% endif %}">
                        {{ order.status|title }}
                    </span>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>Order Information</h6>
                    <p><strong>Order Date:</strong> {{ order.created_at|date:"M d, Y H:i" }}</p>
                    <p><strong>Total Amount:</strong> ₹{{ order.total_amount }}</p>
                    <p><strong>Payment Status:</strong> 
                        <span class="badge bg-{% if order.payment_status %}success{% else %}danger{% endif %}">
                            {{ order.payment_status|yesno:"Paid,Unpaid" }}
                        </span>
                    </p>
                </div>
                <div class="col-md-6">
                    <h6>Shipping Address</h6>
                    <p>{{ order.shipping_address|linebreaks }}</p>
                </div>
            </div>
            
            <hr>
            
            <h6>Order Items</h6>
            {% for item in order.items.all %}
            <div class="row border-bottom py-2 align-items-center">
                <!-- ✅ Added Book Cover -->
                <div class="col-md-1">
                    {% if item.book.cover_image %}
                        <img src="{{ item.book.get_cover_url }}" alt="{{ item.book.title }}" class="img-fluid rounded" style="height: 60px; object-fit: cover;">
                    {% else %}
                        <img src="{% static 'book_outlet/images/book_covers/default_cover.jpg' %}" alt="Default cover" class="img-fluid rounded" style="height: 60px; object-fit: cover;">
                    {% endif %}
                </div>
                <div class="col-md-5">
                    <strong>{{ item.book.title }}</strong><br>
                    <small class="text-muted">by {{ item.book.author }}</small>
                </div>
                <div class="col-md-3 text-center">
                    Quantity: {{ item.quantity }}
                </div>
                <div class="col-md-3 text-end">
                    ₹{{ item.get_total_price }}
                </div>
            </div>
            {% endfor %}
            
            <div class="row mt-3">
                <div class="col-md-12 text-end">
                    <h5>Total: ₹{{ order.total_amount }}</h5>
                </div>
            </div>
            
            {% if not order.payment_status %}
            <div class="row mt-4">
                <div class="col-md-12 text-center">
                    <a href="{% url 'book_outlet:process_payment' order.id %}" class="btn btn-success btn-lg">
                        Make Payment - ₹{{ order.total_amount }}
                    </a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="mt-3">
        <a href="{% url 'book_outlet:order_list' %}" class="btn btn-outline-secondary">Back to Orders</a>
    </div>
</div>
{% endblock %}